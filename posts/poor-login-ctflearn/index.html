<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Poor Login CTFlearn Binary Easy" /><meta name="author" content="bt7274" /><meta property="og:locale" content="en_US" /><meta name="description" content="Original Problem If you download the file and unzip it, you get a folder named pwn_login, which contains 2 files. Okay, so I have an executable and the source code of the program that if running on the server. Upon checking the login with the file command I get the output - 1 login: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=304e214a790bd6fcd1ae83aa2dfd0a9cf7c8462c, not stripped Lets make the program executable with chmod +x and run it I get some kind of login, that lets us login with a username, save our login, restore our login, signout and also print the flag. But it shows that I am not admin and I have to define our own flag, which gets printed as flag. Now, lets look at the accompanying source file. ```c #include #include #include" /><meta property="og:description" content="Original Problem If you download the file and unzip it, you get a folder named pwn_login, which contains 2 files. Okay, so I have an executable and the source code of the program that if running on the server. Upon checking the login with the file command I get the output - 1 login: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=304e214a790bd6fcd1ae83aa2dfd0a9cf7c8462c, not stripped Lets make the program executable with chmod +x and run it I get some kind of login, that lets us login with a username, save our login, restore our login, signout and also print the flag. But it shows that I am not admin and I have to define our own flag, which gets printed as flag. Now, lets look at the accompanying source file. ```c #include #include #include" /><link rel="canonical" href="https://devbt7274.github.io/posts/poor-login-ctflearn/" /><meta property="og:url" content="https://devbt7274.github.io/posts/poor-login-ctflearn/" /><meta property="og:site_name" content="bt7274" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-04T11:10:00+05:30" /><meta name="google-site-verification" content="GeIng0cxQqxmafcZNzt8XRifDZ5UmRSLMx-3bvT63l0" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"bt7274"},"description":"Original Problem If you download the file and unzip it, you get a folder named pwn_login, which contains 2 files. Okay, so I have an executable and the source code of the program that if running on the server. Upon checking the login with the file command I get the output - 1 login: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=304e214a790bd6fcd1ae83aa2dfd0a9cf7c8462c, not stripped Lets make the program executable with chmod +x and run it I get some kind of login, that lets us login with a username, save our login, restore our login, signout and also print the flag. But it shows that I am not admin and I have to define our own flag, which gets printed as flag. Now, lets look at the accompanying source file. ```c #include #include #include","@type":"BlogPosting","headline":"Poor Login CTFlearn Binary Easy","dateModified":"2020-11-04T11:10:00+05:30","datePublished":"2020-11-04T11:10:00+05:30","url":"https://devbt7274.github.io/posts/poor-login-ctflearn/","mainEntityOfPage":{"@type":"WebPage","@id":"https://devbt7274.github.io/posts/poor-login-ctflearn/"},"@context":"https://schema.org"}</script><title>Poor Login CTFlearn Binary Easy | bt7274</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><meta name="google-site-verification" content="GeIng0cxQqxmafcZNzt8XRifDZ5UmRSLMx-3bvT63l0" /><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">bt7274</a></div><div class="site-subtitle font-italic">code coffee game.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Poor Login CTFlearn Binary Easy</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Poor Login CTFlearn Binary Easy</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Nov 4, 2020, 11:10 AM +0530" > Nov 4 <i class="unloaded">2020-11-04T11:10:00+05:30</i> </span> by <span class="author"> bt7274 </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Nov 5, 2020, 12:12 AM +0530" > Nov 5 <i class="unloaded">2020-11-05T00:12:54+05:30</i> </span></div></div><div class="post-content"><p><a href="https://ctflearn.com/challenge/1013">Original Problem</a><br /> If you download the file and unzip it, you get a folder named pwn_login, which contains 2 files. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../../assets/img/poor_login_ctflearn/1.png" alt="Login" width="720" class="normal" /><br /> Okay, so I have an executable and the source code of the program that if running on the server. Upon checking the <code class="language-plaintext highlighter-rouge">login</code> with the <code class="language-plaintext highlighter-rouge">file</code> command I get the output -</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>login: ELF 64-bit LSB pie executable, x86-64, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="k">for </span>GNU/Linux 3.2.0, BuildID[sha1]<span class="o">=</span>304e214a790bd6fcd1ae83aa2dfd0a9cf7c8462c, not stripped
</pre></table></code></div></div><p>Lets make the program executable with <code class="language-plaintext highlighter-rouge">chmod +x</code> and run it <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../../assets/img/poor_login_ctflearn/2.png" alt="Login" width="720" class="normal" /><br /> I get some kind of login, that lets us login with a username, save our login, restore our login, signout and also print the flag. But it shows that I am not admin and I have to define our own flag, which gets printed as flag. Now, lets look at the accompanying source file.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
</span>
<span class="kt">int</span> <span class="nf">menu</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"*** WINBLOWS LOGIN *********</span><span class="se">\n</span><span class="s">"</span>
      <span class="s">"1. Login into user.</span><span class="se">\n</span><span class="s">"</span>
      <span class="s">"2. Sign out.</span><span class="se">\n</span><span class="s">"</span>
      <span class="s">"3. Print flag.</span><span class="se">\n</span><span class="s">"</span>
      <span class="s">"4. Lock user.</span><span class="se">\n</span><span class="s">"</span>
      <span class="s">"5. Restore user.</span><span class="se">\n</span><span class="s">"</span>
      <span class="s">"&gt; "</span><span class="p">);</span>
  
  <span class="kt">int</span> <span class="n">resp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">resp</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">getchar</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">resp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">creds</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">padding</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">admin</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">creds</span> <span class="o">*</span><span class="n">curr</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">creds</span> <span class="o">*</span><span class="n">save</span><span class="p">;</span>

<span class="kt">char</span> <span class="o">*</span><span class="n">fake_flag</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

  <span class="n">setbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">setbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">menu</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1">// Login</span>
        <span class="n">curr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">curr</span><span class="p">));</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">"Username: "</span><span class="p">);</span>
        <span class="n">fgets</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">),</span> <span class="n">stdin</span><span class="p">);</span>
        <span class="n">strtok</span><span class="p">(</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

        <span class="n">curr</span><span class="o">-&gt;</span><span class="n">admin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mi">2</span><span class="p">:</span> <span class="c1">// Sign out</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">curr</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">puts</span><span class="p">(</span><span class="s">"You are not logged in!"</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">free</span><span class="p">(</span><span class="n">curr</span><span class="p">);</span>
        <span class="n">curr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"You have been successfully logged out."</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mi">3</span><span class="p">:</span> <span class="c1">// Print flag</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">curr</span> <span class="o">&amp;&amp;</span> <span class="n">curr</span><span class="o">-&gt;</span><span class="n">admin</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">puts</span><span class="p">(</span><span class="s">"Here's your flag:"</span><span class="p">);</span>
          <span class="n">system</span><span class="p">(</span><span class="s">"/bin/cat /flag.txt"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fake_flag</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">puts</span><span class="p">(</span><span class="s">"You are not admin. Would you like to create a new flag instead?"</span><span class="p">);</span>
            <span class="n">fgets</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buff</span><span class="p">),</span> <span class="n">stdin</span><span class="p">);</span>
            <span class="n">fake_flag</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="n">buff</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="n">printf</span><span class="p">(</span><span class="s">"Here's your flag: %s"</span><span class="p">,</span> <span class="n">fake_flag</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"flag %x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">buff</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mi">4</span><span class="p">:</span> <span class="c1">// Lock user</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">curr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">puts</span><span class="p">(</span><span class="s">"You are not logged in!"</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">puts</span><span class="p">(</span><span class="s">"User has been locked now."</span><span class="p">);</span>
        <span class="n">save</span> <span class="o">=</span> <span class="n">curr</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mi">5</span><span class="p">:</span> <span class="c1">// Restore user</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">curr</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">puts</span><span class="p">(</span><span class="s">"You are already logged. Sign out first!"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">save</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">puts</span><span class="p">(</span><span class="s">"No user is currently locked!"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">printf</span><span class="p">(</span><span class="s">"Welcome back, %s!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">save</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
          <span class="n">curr</span> <span class="o">=</span> <span class="n">save</span><span class="p">;</span>
          <span class="n">save</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="nl">default:</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"Invalid choice"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The first thing I notice is <code class="language-plaintext highlighter-rouge">case 3</code>, print flag, which checks if the user is admin or not. The credentials are stored in a <code class="language-plaintext highlighter-rouge">cred</code> structure. Next, I see in <code class="language-plaintext highlighter-rouge">case 1</code>, admin is explicitly set to 0, so it impossible to make the current user admin while creating it. The user can only be made admin while restoring user. Next, I see the code for logout where the sturct if <code class="language-plaintext highlighter-rouge">free</code>d or deleted. And the <code class="language-plaintext highlighter-rouge">lock user</code> saves the value of <code class="language-plaintext highlighter-rouge">curr</code> in <code class="language-plaintext highlighter-rouge">save</code>. But, won’t it cause a problem, when I login, lock user, logout and then restore user. Because when I signout, the struct would be deleted and upon restoring user, the data would be restored from an already freed memory area. A memory once freed shouldn’t be referenced because it can’t be trusted. Let’s test this theory. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../../assets/img/poor_login_ctflearn/3.png" alt="Login" width="720" class="normal" /><br /> Okay, so the user restore works properly, but it’s obviously printing out gibberish instead of the username I provided. So, what if I login, lock user, logout and try to print flag, and then restore user. The print flag isn’t checking if any user is logged in or not. And once a head memory is free it is returned to the OS and It would assign that same memory the next time heap memory is asked for. There is a chance we might be able to overwrite the free cred struct, make the admin value something positive, when it is restored. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../../assets/img/poor_login_ctflearn/4.png" alt="Login" width="720" class="normal" /><br /> Okay, so this is working. What really happened is, the elements of the struct are saved next to each other. When we locked the user, the address was stored. But we free it when we signout and when we define our flag, we overwrite that same memory address whose reference is stored in save. And we restore user, since our flag was greater than 48 character(in C strings are null terminated), we overwrite the admin variable too and hence we have the access. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="../../assets/img/poor_login_ctflearn/5.png" alt="Login" width="720" class="normal" /><br /> Running the same steps on the server we have the flag.</p><p>PS: The username doesn’t matter. It can be whatever you wish. It’s the flag size that matters and it’s size should be greater than 48 and less than 56. But why 56?? Isn’t the size of flag defined to be 64 characters, and it will overwrite the username area and also the flag variable in that too, right??<br /> There is something called as fast heap, bin and chunk size which will change the location where the flag is stored if it is greater than 56.<br /> <a href="https://heap-exploitation.dhavalkapil.com/diving_into_glibc_heap/bins_chunks">Read More About Heap</a><br /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/binary/'>Binary</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/easy/" class="post-tag no-text-decoration" >easy</a> <a href="/tags/heap/" class="post-tag no-text-decoration" >heap</a> <a href="/tags/binary/" class="post-tag no-text-decoration" >binary</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Poor Login CTFlearn Binary Easy - bt7274&url=https://devbt7274.github.io/posts/poor-login-ctflearn/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Poor Login CTFlearn Binary Easy - bt7274&u=https://devbt7274.github.io/posts/poor-login-ctflearn/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Poor Login CTFlearn Binary Easy - bt7274&url=https://devbt7274.github.io/posts/poor-login-ctflearn/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/poor-login-ctflearn/">Poor Login CTFlearn Binary Easy</a><li><a href="/posts/setting-up-a-minimal-debian-vm-using-qemu/">Setting up a minimal DEBIAN VM using QEMU</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/binary/">binary</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/debian/">debian</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/heap/">heap</a> <a class="post-tag" href="/tags/qemu/">qemu</a> <a class="post-tag" href="/tags/virtual-machine/">virtual machine</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/setting-up-a-minimal-debian-vm-using-qemu/"><div class="card-body"> <span class="timeago small" > Nov 3 <i class="unloaded">2020-11-03T01:20:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Setting up a minimal DEBIAN VM using QEMU</h3><div class="text-muted small"><p> Backstory While there can be many reasons as to why you would need a virtual machine, maintaing clean environment and dependency is one of them. I have triple boot laptop, with windows, ubuntu and ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/setting-up-a-minimal-debian-vm-using-qemu/" class="btn btn-outline-primary"><p>Setting up a minimal DEBIAN VM using QEMU</p></a> <span class="btn btn-outline-primary disabled"><p>-</p></span></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://github.com/devbt7274">bt7274</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/binary/">binary</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/debian/">debian</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/heap/">heap</a> <a class="post-tag" href="/tags/qemu/">qemu</a> <a class="post-tag" href="/tags/virtual-machine/">virtual machine</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://devbt7274.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); </script>
